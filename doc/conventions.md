# Правила разработки кода

Документ описывает основные правила и соглашения при разработке кода для проекта LLMStart.  
Подробности архитектуры и принципов разработки см. в [@vision.md](./vision.md).

## 1. Общие принципы

- Следовать принципу **KISS**: минимальная сложность решений, только необходимые инструменты.
- **MVP-first**: сначала реализуем минимально жизнеспособный функционал.
- **Итеративная разработка**: маленькие шаги → быстрые проверки → улучшения.
- Поддерживать **чистую и модульную структуру**: код должен быть читаемым и легко расширяемым.
- Использовать **минимум инфраструктуры**: хранение данных только в памяти (dict/list), без баз данных и сторонних сервисов.

## 2. Структура проекта

- `bot/` — интерфейс Telegram:
  - `main.py` — запуск бота
  - `handlers.py` — обработка команд и сообщений
  - `keyboards.py` — кнопки Telegram
  - `parser.py` — приём данных пользователя
  - `response_formatter.py` — подготовка ответов
  - `utils.py` — вспомогательные функции
- `llm/` — работа с LLM:
  - `client.py` — API-запросы к OpenRouter
  - `summarizer.py` — генерация конспектов
  - `translator.py` — перевод текста
- `services/` — обработка текста и PDF:
  - `pdf_service.py`, `text_service.py`, `summary_service.py`
- `tests/` — unit-тесты для всех модулей
- `doc/` — документация проекта
- Конфигурация: `.env`, `pyproject.toml`, `Makefile`, `Dockerfile`

## 3. Правила кодирования

- **Именование**: snake_case для функций и переменных, PascalCase для классов.
- **Функции**: короткие, с одной ответственностью, максимально читаемые.
- **Комментарии**: поясняют *почему*, а не *что* делает код.
- **Типизация**: использовать Python type hints для всех публичных функций.
- **Обработка ошибок**: все критические операции должны иметь try/except с логированием (`logging`).

## 4. Работа с LLM

- Все взаимодействия через `llm/client.py`.
- Использовать строго определённые промпты для:
  - структурированного конспекта (`summarizer.py`)
  - объяснения «для новичка» (`summarizer.py`)
  - перевода (`translator.py`)
- Разбивать текст на чанки (~3000–4000 символов) перед отправкой.
- Логи ошибок и времени отклика должны фиксироваться для мониторинга.

## 5. Логирование

- Использовать стандартный модуль `logging`.
- Логи должны включать: timestamp, уровень, модуль, сообщение.
- Основные события для логирования:
  - действия пользователя (`bot/handlers.py`)
  - ошибки при обработке PDF/текста (`services/`)
  - запросы и ответы LLM (`llm/`)
- Уровни логирования:
  - `DEBUG` — подробная информация
  - `INFO` — основные действия
  - `WARNING` / `ERROR` — ошибки и исключения

## 6. Тестирование

- Использовать `pytest`.
- Мокировать внешние сервисы (LLM, Telegram API) для unit-тестов.
- Покрывать ключевые пути обработки данных и ошибок.

## 7. Конфигурация и окружение

- Все ключи и параметры через `.env`.
- Настройки Python-проектов через `pyproject.toml`.
- Конфигурация должна быть централизованной (например, `config.py`).
- Не хранить чувствительные данные в репозитории.

## 8. Docker и Makefile

- Для запуска и сборки использовать Docker и Makefile.
- Контейнер должен быть воспроизводимым и изолированным.
- Makefile автоматизирует сборку (`make build`) и запуск (`make run`).

## 9. Ссылки

- Основные принципы и архитектура проекта: [@vision.md](./vision.md)
