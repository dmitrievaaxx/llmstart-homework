# Правила разработки кода

> Основано на принципах из [@vision.md](doc/vision.md)

## Основные принципы

### KISS (Keep It Simple, Stupid)
- **Минимальная сложность**: используй только необходимые инструменты и решения
- **Простые конструкции**: избегай сложных абстракций, выбирай прямолинейные решения
- **Один файл = одна ответственность**: не смешивай логику разных слоёв

### MVP-first
- **Только необходимое**: реализуй только функциональность, описанную в [@vision.md](doc/vision.md)
- **Итеративно**: маленькие шаги → быстрые проверки → улучшения
- **Без излишеств**: не добавляй функции "на будущее"

## Структура кода

### Архитектура слоёв
Следуй архитектуре из [@vision.md](doc/vision.md):
- `bot/` — только интерфейс Telegram
- `llm/` — только работа с LLM
- `parser.py` — только извлечение текста

### Изоляция ответственности
- **Без скрытых зависимостей**: каждый модуль должен быть понятен из его интерфейса
- **Чистые функции**: предпочитай функции без побочных эффектов
- **Явные зависимости**: передавай все зависимости через параметры

## Хранение данных

### Только в памяти
- **Никаких БД**: используй только `dict`/`list` для хранения состояния
- **Без персистентности**: каждый запрос обрабатывается отдельно
- **Простое состояние**: храни только необходимое для текущего запроса

## Обработка ошибок

### Простая обработка
- **Явные ошибки**: если что-то не работает, сообщи пользователю
- **Graceful degradation**: при ошибке LLM возвращай понятное сообщение
- **Логирование**: фиксируй ошибки через простой `print()` или `logging`

## Логирование

### Минимальное логирование
Логируй только согласно [@vision.md](doc/vision.md):
```python
log_entry = {
    "input_type": "pdf",
    "chunks": 3,
    "summary_type": "sections", 
    "status": "success",
    "time_sec": 12.4
}
```

## Конфигурация

### Переменные окружения
- Используй только переменные из [@vision.md](doc/vision.md): `TELEGRAM_BOT_TOKEN`, `OPENROUTER_API_KEY`, `MAX_CHUNK_SIZE`, `LOG_LEVEL`
- Никаких сложных конфигов
- Все настройки через `.env` файл

## Технологии

### Строго по стеку
Используй только технологии из [@vision.md](doc/vision.md):
- Python 3.11+
- `python-telegram-bot` для Telegram API
- `openai` клиент для OpenRouter
- `pdfplumber` для PDF
- `pytest` для тестов

## Качество кода

### Читаемость
- **Понятные имена**: переменные и функции должны объяснять своё назначение
- **Короткие функции**: максимум 20-30 строк
- **Документация**: только для сложной логики, не для очевидного

### Типизация
- Используй type hints для всех публичных функций
- Не усложняй типизацию для простых случаев

## Тестирование

### Простые тесты
- Тестируй только публичные интерфейсы
- Один тест = один сценарий
- Используй `pytest` как указано в [@vision.md](doc/vision.md)

---

**Помни**: цель — создать работающий MVP для проверки идеи, а не идеальный код. Простота важнее элегантности.
